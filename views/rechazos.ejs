<div class="container-fluid">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Consulta de Rechazos</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="input-group">
                        <input type="date" id="fechaConsulta" class="form-control">
                        <button id="btnConsultar" class="btn btn-primary">
                            <i class="fas fa-search me-1"></i>Consultar
                        </button>
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <div class="form-check form-switch d-inline-block">
                        <input class="form-check-input" type="checkbox" id="vistaCompleta">
                        <label class="form-check-label" for="vistaCompleta">Vista Completa</label>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <table id="tablaDatos" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <!-- Las columnas se agregarán dinámicamente -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los datos se agregarán dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div id="loadingOverlay" class="loading-overlay">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fechaHoy = new Date().toISOString().split('T')[0];
        document.getElementById('fechaConsulta').value = fechaHoy;
    });
    document.getElementById('btnConsultar').addEventListener('click', async function() {
        const fecha = document.getElementById('fechaConsulta').value;
        const vistaCompleta = document.getElementById('vistaCompleta').checked;
        const loadingOverlay = document.getElementById('loadingOverlay');
        const tabla = document.getElementById('tablaDatos');
        loadingOverlay.style.display = 'flex';
        try {
            const response = await fetch(`/api/rechazos/consulta?fecha=${fecha}&vistaCompleta=${vistaCompleta}`);
            const data = await response.json();
            if (!response.ok) {
                throw new Error(data.error || 'Error al consultar los datos');
            }
            if (!data || data.length === 0) {
                Swal.fire({
                    icon: 'info',
                    title: 'Sin resultados',
                    text: 'No se encontraron datos para la fecha seleccionada'
                });
                tabla.querySelector('thead tr').innerHTML = '';
                tabla.querySelector('tbody').innerHTML = '';
                return;
            }
            // Generar encabezados
            const headers = Object.keys(data[0]);
            tabla.querySelector('thead tr').innerHTML = headers
                .map(header => `<th>${header}</th>`)
                .join('');
            // Generar filas de datos
            tabla.querySelector('tbody').innerHTML = data
                .map(row => `
                    <tr>
                        ${headers.map(header => `<td>${row[header] || ''}</td>`).join('')}
                    </tr>
                `)
                .join('');
        } catch (error) {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Ocurrió un error al consultar los datos: ' + error.message
            });
        } finally {
            loadingOverlay.style.display = 'none';
        }
    });
</script>